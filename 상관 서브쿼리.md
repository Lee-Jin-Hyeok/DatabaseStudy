## 상관 서브쿼리

### 1. 상관 서브쿼리란?

상관 서브쿼리는 서브쿼리를 사용할 때 바깥 쿼리와 안쪽의 서브쿼리의 관계를 이용하여 서브쿼리를 작성할 때
그 서브쿼리를 상관 서브쿼리라고 한다.

따라서 상관 서브쿼리를 사용할 때는 내부의 쿼리가 외부의 쿼리에게 의존하는 형태를 띄게 됩니다.

### 2. 상관 서브쿼리를 사용하는 이유

내부의 쿼리가 외부의 쿼리에 의존하여 값을 처리해야할 때 사용해야 하므로 당연히 사용해야 합니다.

### 3. 상관 서브쿼리 사용하기

상관 서브쿼리를 사용하는 방법은 언뜻보면 어려워 보이지만 쉽게 생각하면 쉽습니다.
일단 상관 서브쿼리의 예시를 한 번 살펴보자.
다음의 문제는 SQL ZOO라는 사이트에서 가져온 것이다.

```sql
-- 문제
-- Find the largest country (by area) in each continent,
-- show the continent, the name and the area:

-- 각 대륙에서 가장 큰 국가 (지역별)를 찾아 대륙, 이름 및 지역을 표시하십시오.
-- ----------------------------------------------------------------------
SELECT continent, name, area FROM world x
	WHERE area >= ALL
    	(SELECT area FROM world y
        	WHERE y.continent=x.continent
          		AND area>0)
```

상관 서브쿼리를 사용할 때에는 외부 쿼리의 테이블과 내부 쿼리의 테이블을
각각 다른 개체로 보는 것이 주 기능이다.

쉽게 생각하면 이중 for문이라고 생각하면 쉽다.
외부 쿼리의 테이블 하나를 집고 내부 쿼리의 테이블의 모든 레코드를 돌려가면서 비교한다.

위 문제에서는 각 대륙에서 가장 큰 국가를 찾아야 하므로 같은 대륙에 있는 국가끼리만 비교해야 한다.
따라서 내부 쿼리의 WHERE 절에서 같은대륙인지 확인하고 area를 반환함으로서
외부 쿼리가 내부 쿼리의 area값을 받아내는 방식을 사용한다.

상관 서브쿼리를 사용할 때는 테이블에게 별칭을 각각 부여하여
외부 쿼리의 테이블과 내부 쿼리의 테이블을 구부해야 하는데, 
이러기 위해서 world라는 테이블에 외부 쿼리에서는 x, 내부 쿼리에서는 y라는 별칭을 부여한다.
world와 x사이에 AS 기호가 없는데 이것은 생략가능하기 때문이다.
사실 붙여도 상관 없다.